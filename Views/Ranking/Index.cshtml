@model List<QuizWeb_TrioForce.ViewModels.RankingListViewModel>

@{
    ViewData["Title"] = "Bảng xếp hạng";
    var currentUsername = User?.Identity?.Name; 
}


<div class="ranking-container fade-in-up">
    <h1 class="fade-in-up fade-in-delay-1">🏆 Bảng Xếp Hạng</h1>
    
    @if (Model != null && Model.Any())
    {
        <div class="ranking-table-wrapper fade-in-up fade-in-delay-2">
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th>Hạng</th>
                        <th>Tên người chơi</th>
                        <th>Điểm số</th>
                    </tr>
                </thead>
            </table>
            
            <div class="ranking-tbody-wrapper">
                <table class="ranking-table">
                    <tbody>
                        @for (int i = 0; i < Model.Count; i++)
                        {
                            var isCurrentUser = Model[i].Username == currentUsername;
                            var rowClass = i < 3 ? "top-" + (i + 1) : "";
                            if (isCurrentUser) rowClass += " current-user";
                            
                            <tr class="@rowClass" data-username="@Model[i].Username" id="rank-@i">
                                <td class="rank-col">
                                    @if (i == 0) { <span>🥇</span> }
                                    else if (i == 1) { <span>🥈</span> }
                                    else if (i == 2) { <span>🥉</span> }
                                    else { <span>@(i + 1)</span> }
                                </td>
                                <td class="username-col">
                                    @Model[i].Username
                                    @if (isCurrentUser) { <span class="you-badge">Bạn</span> }
                                </td>
                                <td class="score-col">@Model[i].TotalScore</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
        
        @if (!string.IsNullOrEmpty(currentUsername))
        {
            var userRank = Model.FindIndex(u => u.Username == currentUsername);
            if (userRank >= 0)
            {
                <div class="current-user-info-bottom fade-in-up fade-in-delay-3" onclick="scrollToCurrentUser()">
                    <span class="info-icon">👤</span>
                    <span>Hạng của bạn: <strong>#@(userRank + 1)</strong></span>
                    <span class="click-hint"> Nhấn để xem</span>
                </div>
            }
        }
    }
    else
    {
        <div class="empty-message fade-in-up fade-in-delay-2">
            <p>Chưa có dữ liệu xếp hạng</p>
        </div>
    }
</div>

@section Scripts {
    <script src="~/js/ranking.js" asp-append-version="true"></script>
}
